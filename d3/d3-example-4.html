<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pie Chart Example</title>
    <style>
        body {
            background: lightgoldenrodyellow;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
        }
        .arc {
            stroke: #fff;
            stroke-width: 1px;
            transition: opacity 0.2s;
        }
    </style>
    
    <script src="https://d3js.org/d3.v6.js"></script>
</head>
<body>
    <script>
        const { csv, select, pie, arc, scaleOrdinal, schemeDark2 } = d3;

        const csvUrl = "test-2.csv";
        const width = 640;
        const height = 480;
        const radius = Math.min(width, height) / 2 - 20;

        const parseRow = (d) => {
            d.percentage = +d.percentage;
            return d;
        }

        const svg = select('body')
            .append('svg')
            .attr('width', width)
            .attr('height', height)
            .append('g')
            .attr('transform', `translate(${width / 2}, ${height / 2})`);

        const createChart = async () => {
            const data = await csv(csvUrl, parseRow);

            const color = scaleOrdinal()
                .domain(data.map(d => d.item))
                .range(schemeDark2);

            const pieGenerator = pie()
                .value(d => d.percentage);

            const arcGenerator = arc()
                .innerRadius(0)
                .outerRadius(radius);

            const arcs = svg.selectAll('.arc')
                .data(pieGenerator(data))
                .join('g')
                .attr('class', 'arc');

            arcs.append('path')
                .attr('d', arcGenerator)
                .attr('fill', d => color(d.data.item))

            arcs.append('text')
                .attr('transform', d => `translate(${arcGenerator.centroid(d)})`)
                .attr('text-anchor', 'middle')
                .style('font-size', '14px')
                .style('stroke', 'none')
                .style('fill', 'white')
                .text(d => `${d.data.percentage}%`);
        }

        createChart();
    </script>
</body>
</html>
